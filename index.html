<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="theme-color" content="#000">
<meta name="viewport" content="initial-scale=1,minimum-scale=1,maximum-scale=1">
<title>ojito.cam</title>
<link rel="alternate" type="application/atom+xml" title="ojito.cam" href="https://www.flickr.com/services/feeds/photos_public.gne?id=185897100@N04">
<link rel="apple-touch-icon" href="icons/ojito-180.png">
<link rel="icon" href="favicon.ico" sizes="any">
<link rel="manifest" href="icons/manifest.webmanifest">
<link rel="me" href="https://mastodon.social/@ojito">
<link rel="stylesheet" href="cps/stylesheet.css">
<link rel="stylesheet" href="style.css?1703961507">
<script src="smartquotes.js"></script>
<script>
if (window.location.href.slice(-1) === '?') 
	history.replaceState('','',window.location.pathname);
function ready() {
	smartquotes();
	if (window.location.search === '?=') {
		const output = $photos.innerHTML.replaceAll('&','&amp;'), lines = output.split('\n').length;
		document.body.innerHTML = `<section><textarea rows="${lines}" onClick="this.setSelectionRange(0,this.value.length)">${output}</textarea></section>`;
	}
}
</script>
</head>

<body onload="ready()">
<header>
	<span><input type="text" placeholder="camera,tags" onchange="window.location.href='?'+this.value"></span>
</header>
<main>
	<ul id="photos"></ul>
</main>
<footer>
	<h2>popular tags</h2>
	<ul id="tags" class="min"><li class="etc"><a href="#tags" onclick="$tags.classList.remove('min')">...</a></li></ul>
	<h2>all photos</h2>
	<ul><li><a href="https://flickr.com/photos/ojitocam/">flickr.com/ojitocam</a></li></ul>
</footer>
<script>
const $photos = document.getElementById('photos');
const $tags = document.getElementById('tags');

function a(text,url,c,title) {
	const $a = document.createElement('a');
	$a.append(text);
	$a.setAttribute('href',(url.slice(0,2)==='//')?'https:'+url:url);
	if (c) $a.className = c;
	if (title) $a.setAttribute('title',title);
	return $a;
}
function jsonFlickrApi(obj) {
	obj.who.tags.tag
		.sort(function(a,b){return a.count-b.count;})
		.forEach((obj) => {
			const $li = document.createElement('li');
			$li.append(a(obj._content,'?'+obj._content,0,obj.count+' photos'));
			$tags.prepend($li);
		})
	;
}
function jsonFlickrFeed(feed) {
	if (!feed.items.length) {
		$photos.innerHTML = '<li class="none">no results</li>';
		$tags.classList.remove('min');
		return;
	} else if (query && query.indexOf('=') < 0) {
		document.title = "ojito.cam: "+query;
		document.body.className = 'tagged';
	}
	feed.items.sort((a,b) => {
   		return Date.parse(b.date_taken) - Date.parse(a.date_taken);
	});
	for (const item of feed.items) {
		const $div = document.createElement('div');
		const $img = document.createElement('img');
		$img.setAttribute('src',item.media.m.slice(0,-5)+'b.jpg');
		$img.setAttribute('alt','');
		$div.append($img);

		const $time = document.createElement('time');
		const timestamp = item.date_taken;
		$time.setAttribute('datetime',timestamp);
		$time.setAttribute('title',timestamp.slice(11,16));
		$time.textContent = timestamp.slice(0,10).replaceAll('-','.');

		let $at = false, desc = false,
			$desc = document.createElement('li'),
			p = item.description.split('<p>');
		if (p.length > 3 && p[3].trim() !== '</p>') {
			$desc.innerHTML = '<p>'+p[3].trim().replaceAll('="/',`="${feed.generator}/`);
			p = $desc.firstChild.childNodes;
			if (p.length === 1 && p[0].tagName === 'A') {
				$at = p[0];
				$at.className = 'at';
				$at.setAttribute('title',$at.textContent);
				$at.textContent = '@';
			} else {
				desc = true;
			}
		}

		const $perma = a($time,item.link.slice(6),'perma');
		const title = item.title.trim();
		if (title[0] === '@') {
			$div.append(' ',$perma,' ',a('@','//www.instagram.com/'+title.slice(1)+'/','at insta',title));
		} else if ($at) {
			$div.append(' ',$perma,' ',$at);
		} else if (title) {
			$perma.append(' ',title);
			$div.append(' ',$perma);
		} else {
			$div.append(' ',$perma);
		}

		let tags = item.tags.split(' '),
			model = tags[0], 
			brand = tags[1],
			last = tags.pop();
		if (model && brand) {
			let m = model, db = 0, path = 0;
			switch(m) {
				case 'dct50':	path = '//www.dpreview.com/articles/0053585370/gatewaydigicams'; break;
				case 'g600':	m = 'dimageg600'; break;
				case 'j1250':	db = 1; break;
				case 'r827':	db = 1; m = 'photosmart-r827'; break;
				case 'sd790':	m = 'sd790is'; break;
				case 'vs20':	m = 'optiovs20'; break;
			}
			if (!path) {
				let slug = (brand === 'olympus') 
					? 'oly_stylus'+m 
					: brand+'_'+m
				;
				path = (db)
					? `//www.digicamdb.com/specs/${slug}/`
					: `//www.dpreview.com/products/${brand}/compacts/${slug}`
				;				
			}
			switch(model) {
				case 'dct50':	model = 'DC-T50'; break;
				case 'griiix':	model = 'GR IIIx'; break;
				case 'kd300z':	model = 'KD-300Z'; break;
				case 'pdr3310':	model = 'PDR-3310'; break;
				case 'uca401':	model = 'U-CA 401'; break;
				case 'verve':	model = 'Verve'; break;
				case 'verves':	model = 'Verve S'; break;
				default: model = (brand === 'olympus') 
					? 'Âµ-'+model 
					: model.toUpperCase().replace(/^(D[MS]C)/,'$1-')
				;
			}
			$div.append(' ',a(model,path));
			if (last === 'fs') $div.append(a('(FS)','//en.wikipedia.org/wiki/Full-spectrum_photography'));
			if (last === 'ir') $div.append(a('(IR)','//en.wikipedia.org/wiki/Infrared_photography'));
		}

		const $li = document.createElement('li');
		$li.append($div);
		$photos.append($li,'\n');
		if (desc) $photos.append($desc,'\n');
	}
}

let json = 'https://www.flickr.com/services/feeds/photos_public.gne?id=185897100@N04&format=json',
	query = window.location.search.slice(1);
if (query && query.indexOf('=') < 0) {
	json += (query.indexOf('+') > 0) 
		? '&tagmode=all&tags='+query.replaceAll('+',',')
		: '&tagmode=any&tags='+query
	;
	query = query.replaceAll('%20',' ');
	document.body.firstElementChild.innerHTML = '<a href="?"><span>'+query+'</span></a>';
}
const $script = document.createElement('script');
$script.setAttribute('src',json);
document.body.append($script);
</script>
<script src="https://www.flickr.com/services/rest/?format=json&method=flickr.tags.getListUserPopular&count=24&user_id=185897100@N04&api_key=370ef6e45f168404fbcc08fc243e800e"></script>
</body>

</html>